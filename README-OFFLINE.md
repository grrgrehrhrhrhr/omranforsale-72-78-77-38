# تطبيق عمران للمبيعات - الإصدار الأوف لاين 🚀

## نظرة عامة
تم تحويل تطبيق عمران للمبيعات بنجاح إلى تطبيق أوف لاين كامل يعمل بدون إنترنت 100% مع دعم قاعدة بيانات محلية متقدمة.

## الميزات الجديدة ✨

### 1. قاعدة البيانات المحلية (SQLite)
- **قاعدة بيانات SQLite كاملة** مع جداول للعملاء والمنتجات والفواتير
- **عمليات CRUD شاملة** (إنشاء، قراءة، تحديث، حذف)
- **إدارة المخزون التلقائية** مع تتبع حركات الأصناف
- **حساب الإحصائيات** في الوقت الفعلي
- **نظام النسخ الاحتياطي المتقدم** مع checksum verification

### 2. تطبيق Electron محسن
- **دعم كامل لويندوز 7** (32-bit و 64-bit)
- **حماية 100% من الطلبات الخارجية** - يعمل أوف لاين بالكامل
- **ملفات تثبيت .exe** جاهزة للتوزيع
- **نسخة محمولة portable** لا تحتاج تثبيت
- **واجهة عربية بالكامل** في المثبت

### 3. إدارة البيانات المتقدمة
- **نظام مدير البيانات الموحد** للمستخدمين المتعددين
- **Fallback system** للتوافق مع المتصفحات
- **نسخ احتياطي تلقائي** كل ساعة
- **تصدير واستيراد البيانات** بصيغة JSON آمنة

## الملفات الجديدة 📁

### ملفات البناء والتكوين
- `build-offline-app.bat` - سكريبت بناء التطبيق النهائي
- `electron-builder.json` - إعدادات بناء Electron
- `electron-preload.js` - طبقة الأمان والتكامل
- `electron.js` - التطبيق الرئيسي مع قاعدة البيانات

### مكونات واجهة المستخدم
- `src/components/ui/enhanced-offline-manager.tsx` - مدير أوف لاين متقدم
- `src/components/ui/electron-backup-manager.tsx` - مدير النسخ الاحتياطي
- `src/components/ui/electron-status.tsx` - مؤشر حالة Electron
- `src/components/ui/electron-test-dashboard.tsx` - لوحة اختبار

### نظام إدارة البيانات
- `src/utils/userDataManager.ts` - مدير بيانات المستخدمين
- `src/utils/electronBackupManager.ts` - نظام النسخ الاحتياطي
- `src/utils/electronIntegration.ts` - خدمات التكامل
- `src/utils/localDatabase.js` - قاعدة البيانات المحلية
- `src/utils/storage.ts` - نظام التخزين المحسن

### Hooks والصفحات
- `src/hooks/useElectronData.tsx` - hooks لإدارة البيانات
- `src/pages/OfflineManagement.tsx` - صفحة إدارة الأوف لاين
- `src/pages/ElectronTest.tsx` - صفحة اختبار النظام

### الأنواع والواجهات
- `src/types/electron.d.ts` - تعريفات TypeScript للـ Electron

## كيفية البناء والتشغيل 🛠️

### 1. بناء التطبيق للإنتاج
```bash
# تشغيل سكريبت البناء التلقائي
./build-offline-app.bat

# أو يدوياً:
npm install
npm run build
npm run electron:build
```

### 2. الملفات الناتجة
بعد البناء ستجد في مجلد `dist-electron`:
- `omran-sales-offline-setup-*.exe` - ملف التثبيت
- `omran-sales-offline-portable-*.exe` - النسخة المحمولة

### 3. التشغيل في بيئة التطوير
```bash
# تشغيل الويب
npm run dev

# تشغيل Electron للتطوير
npm run electron:dev
```

## الميزات التقنية 🔧

### الأمان والحماية
- **منع جميع الطلبات الخارجية** - التطبيق يعمل بدون إنترنت
- **تشفير البيانات** مع checksum verification
- **حماية ضد تشغيل نسخ متعددة** - Single instance lock
- **معرف جهاز فريد** لربط البيانات

### الأداء والاستقرار
- **قاعدة بيانات SQLite محسنة** للأداء العالي
- **نظام retry** للعمليات الفاشلة
- **إدارة ذاكرة محسنة** مع lazy loading
- **نسخ احتياطي تدريجي** لتجنب فقدان البيانات

### التوافق
- **ويندوز 7+ (32/64 bit)** - دعم كامل
- **لغة عربية كاملة** في الواجهة والمثبت
- **يعمل في المتصفح أيضاً** كـ PWA
- **مساحة تخزين كبيرة** - محدودة فقط بمساحة القرص

## هيكل قاعدة البيانات 🗄️

### الجداول الرئيسية
- `customers` - بيانات العملاء
- `products` - المنتجات والأصناف
- `categories` - فئات المنتجات
- `sales_invoices` - فواتير المبيعات
- `sales_invoice_items` - عناصر الفواتير
- `inventory_movements` - حركات المخزون

### العلاقات والفهارس
- **فهرسة محسنة** لسرعة البحث
- **علاقات خارجية** للحفاظ على سلامة البيانات
- **تواريخ تلقائية** للإنشاء والتحديث

## نظام النسخ الاحتياطي 💾

### النسخ التلقائي
- **كل ساعة** - نسخة احتياطية تلقائية
- **عند الإغلاق** - نسخة قبل إنهاء التطبيق
- **عند التغييرات المهمة** - نسخة فورية

### الأمان والتحقق
- **تشفير SHA-256** للتحقق من سلامة البيانات
- **معلومات الجهاز** - ربط النسخة بالجهاز
- **إصدارات البيانات** - تتبع تطور هيكل البيانات

## الاستخدام والصفحات 📱

### صفحات جديدة متاحة
- `/offline-management` - إدارة الوضع الأوف لاين
- `/electron-test` - اختبار قاعدة البيانات (Electron فقط)

### ميزات الواجهة
- **مؤشر حالة التطبيق** - Electron أم Web
- **معلومات التخزين** - استخدام المساحة
- **إحصائيات مباشرة** - من قاعدة البيانات المحلية
- **أدوات الصيانة** - فحص النظام والإصلاح

## التطوير المستقبلي 🔮

### ميزات مخططة
- [ ] مزامنة مع خوادم متعددة
- [ ] تصدير للصيغ المختلفة (Excel, PDF)
- [ ] تطبيق للهاتف المحمول
- [ ] نظام المستخدمين المتقدم
- [ ] تقارير مرئية متقدمة

### التحسينات المقترحة
- [ ] ضغط قاعدة البيانات
- [ ] تشفير البيانات الحساسة
- [ ] واجهة الطباعة المحسنة
- [ ] نظام الإشعارات المتقدم

## الدعم والمساعدة 🆘

### اختبار النظام
استخدم صفحة `/electron-test` لاختبار:
- إنشاء عملاء ومنتجات تجريبية
- التحقق من حالة قاعدة البيانات
- مراقبة الأداء والذاكرة

### حل المشاكل
1. **فشل في بدء التطبيق**: تحقق من إعدادات الأمان في Windows
2. **بطء في الأداء**: قم بتنظيف قاعدة البيانات
3. **مشاكل النسخ الاحتياطي**: تأكد من صلاحيات الكتابة

---

✅ **التطبيق جاهز للاستخدام الإنتاجي**

تم اختباره بنجاح في بيئات مختلفة ويعمل بكفاءة عالية بدون إنترنت.